import streamlit as st
import numpy as np
import scipy.constants as const

# --- –§—ñ–∑–∏—á–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ ---
g = const.g # –ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è –≤—ñ–ª—å–Ω–æ–≥–æ –ø–∞–¥—ñ–Ω–Ω—è

# --- –û—Å–Ω–æ–≤–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∏ ---
with st.container(border=True):
    st.title("üíß –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –†—ñ–≤–Ω—è–Ω–Ω—è –ë–µ—Ä–Ω—É–ª–ª—ñ")
    st.write("–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ç–∏—Å–∫—É —Ç–∞ —à–≤–∏–¥–∫–æ—Å—Ç—ñ –¥–ª—è —ñ–¥–µ–∞–ª—å–Ω–æ—ó —Ä—ñ–¥–∏–Ω–∏, —â–æ —Ç–µ—á–µ –ø–æ —Ç—Ä—É–±—ñ.")

    # --- –ü–ê–†–ê–ú–ï–¢–†–ò –°–ò–ú–£–õ–Ø–¶–Ü–á ---
    st.subheader("–ó–∞–≥–∞–ª—å–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏")
    rho = st.slider(
        "–ì—É—Å—Ç–∏–Ω–∞ —Ä—ñ–¥–∏–Ω–∏ (œÅ), –∫–≥/–º¬≥", 
        min_value=100.0, max_value=2000.0, value=1000.0, step=10.0,
        key="bern_rho", help="1000 –∫–≥/–º¬≥ = –í–æ–¥–∞, 1.225 –∫–≥/–º¬≥ = –ü–æ–≤—ñ—Ç—Ä—è"
    )
    
    st.divider()
    
    # --- –î–≤—ñ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –¢–æ—á–∫–∏ 1 —ñ –¢–æ—á–∫–∏ 2 ---
    col1, col2 = st.columns(2)

    with col1:
        st.header("–¢–æ—á–∫–∞ 1 (–í—Ö—ñ–¥)")
        A1_cm2 = st.number_input("–ü–ª–æ—â–∞ –ø–µ—Ä–µ—Ä—ñ–∑—É (A‚ÇÅ), —Å–º¬≤", min_value=0.1, value=10.0, key="bern_a1")
        h1 = st.number_input("–í–∏—Å–æ—Ç–∞ (h‚ÇÅ), –º", value=2.0, key="bern_h1")
        v1 = st.number_input("–®–≤–∏–¥–∫—ñ—Å—Ç—å –ø–æ—Ç–æ–∫—É (v‚ÇÅ), –º/—Å", min_value=0.1, value=1.0, key="bern_v1")
        P1_kpa = st.number_input("–¢–∏—Å–∫ (P‚ÇÅ), –∫–ü–∞", value=150.0, key="bern_p1")

    with col2:
        st.header("–¢–æ—á–∫–∞ 2 (–í–∏—Ö—ñ–¥)")
        A2_cm2 = st.number_input("–ü–ª–æ—â–∞ –ø–µ—Ä–µ—Ä—ñ–∑—É (A‚ÇÇ), —Å–º¬≤", min_value=0.1, value=5.0, key="bern_a2")
        h2 = st.number_input("–í–∏—Å–æ—Ç–∞ (h‚ÇÇ), –º", value=0.0, key="bern_h2")
        st.info("–®–≤–∏–¥–∫—ñ—Å—Ç—å (v‚ÇÇ) —Ç–∞ –¢–∏—Å–∫ (P‚ÇÇ) –±—É–¥—É—Ç—å —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ.")
        
    st.divider()

    # --- –ë–õ–û–ö –¢–ï–û–†–Ü–á (–í–ò–ü–†–ê–í–õ–ï–ù–û) ---
    with st.expander("üìñ –í—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–µ–æ—Ä—ñ—é —Ç–∞ —Ñ–æ—Ä–º—É–ª–∏", expanded=False):
        st.subheader("–†—ñ–≤–Ω—è–Ω–Ω—è –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω–æ—Å—Ç—ñ (–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–∞—Å–∏)")
        st.write("–î–ª—è –Ω–µ—Å—Ç–∏—Å–ª–∏–≤–æ—ó —Ä—ñ–¥–∏–Ω–∏, –ø–æ—Ç—ñ–∫ (–æ–±'—î–º –∑–∞ —Å–µ–∫—É–Ω–¥—É) —î —Å—Ç–∞–ª–∏–º:")
        st.latex(r"A_1 v_1 = A_2 v_2")
        st.write("–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ —É –≤—É–∑—å–∫—ñ–π —á–∞—Å—Ç–∏–Ω—ñ —Ç—Ä—É–±–∏ ($A_2 < A_1$) —à–≤–∏–¥–∫—ñ—Å—Ç—å ($v_2$) **–∑—Ä–æ—Å—Ç–∞—î**.")
        
        st.subheader("–†—ñ–≤–Ω—è–Ω–Ω—è –ë–µ—Ä–Ω—É–ª–ª—ñ (–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó)")
        st.write("–ü–æ–≤–Ω–∞ –µ–Ω–µ—Ä–≥—ñ—è (—Ç–∏—Å–∫ + –∫—ñ–Ω–µ—Ç–∏—á–Ω–∞ + –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞) –Ω–∞ –æ–¥–∏–Ω–∏—Ü—é –æ–±'—î–º—É —î —Å—Ç–∞–ª–æ—é –≤–∑–¥–æ–≤–∂ –ª—ñ–Ω—ñ—ó —Ç–æ–∫—É:")
        st.latex(r"P_1 + \frac{1}{2}\rho v_1^2 + \rho g h_1 = P_2 + \frac{1}{2}\rho v_2^2 + \rho g h_2")
        
        # --- –û–°–¨ –¢–£–¢ –ë–£–õ–ê –ü–û–ú–ò–õ–ö–ê, –¢–ï–ü–ï–† –í–ò–ü–†–ê–í–õ–ï–ù–û ---
        # (–†–æ–∑–¥—ñ–ª–µ–Ω–æ st.markdown —ñ st.latex)
        st.markdown("* $P$ ‚Äî —Å—Ç–∞—Ç–∏—á–Ω–∏–π —Ç–∏—Å–∫")
        st.markdown("* –î–∏–Ω–∞–º—ñ—á–Ω–∏–π —Ç–∏—Å–∫ (–∫—ñ–Ω–µ—Ç–∏—á–Ω–∞ –µ–Ω–µ—Ä–≥—ñ—è):")
        st.latex(r"\frac{1}{2}\rho v^2")
        st.markdown("* –ì—ñ–¥—Ä–æ—Å—Ç–∞—Ç–∏—á–Ω–∏–π —Ç–∏—Å–∫ (–ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞ –µ–Ω–µ—Ä–≥—ñ—è):")
        st.latex(r"\rho g h")
        # --- –ö–Ü–ù–ï–¶–¨ –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø ---

    # --- –†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ ---
    
    # –ü–µ—Ä–µ–≤–æ–¥–∏–º–æ –≤ –°–Ü
    A1 = A1_cm2 / 10000.0 # —Å–º¬≤ -> –º¬≤
    A2 = A2_cm2 / 10000.0 # —Å–º¬≤ -> –º¬≤
    P1 = P1_kpa * 1000.0 # –∫–ü–∞ -> –ü–∞
    
    # 1. –ó–Ω–∞—Ö–æ–¥–∏–º–æ v‚ÇÇ –∑ —Ä—ñ–≤–Ω—è–Ω–Ω—è –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω–æ—Å—Ç—ñ
    v2 = v1 * (A1 / A2)
    
    # 2. –ó–Ω–∞—Ö–æ–¥–∏–º–æ P‚ÇÇ –∑ —Ä—ñ–≤–Ω—è–Ω–Ω—è –ë–µ—Ä–Ω—É–ª–ª—ñ
    # P‚ÇÇ = P‚ÇÅ + 0.5*rho*(v‚ÇÅ¬≤ - v‚ÇÇ¬≤) + rho*g*(h‚ÇÅ - h‚ÇÇ)
    P2 = P1 + 0.5 * rho * (v1**2 - v2**2) + rho * g * (h1 - h2)
    P2_kpa = P2 / 1000.0 # –ü–∞ -> –∫–ü–∞
    
    st.header("–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É (—É –¢–æ—á—Ü—ñ 2)")
    
    col_res1, col_res2 = st.columns(2)
    col_res1.metric("–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å (v‚ÇÇ)", f"{v2:.2f} –º/—Å", delta=f"{v2-v1:.2f} –º/—Å")
    col_res2.metric("–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∏–π —Ç–∏—Å–∫ (P‚ÇÇ)", f"{P2_kpa:.2f} –∫–ü–∞", delta=f"{P2_kpa-P1_kpa:.2f} –∫–ü–∞")
    
    # –ü–æ—è—Å–Ω–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
    if v2 > v1:
        st.success("–†—ñ–¥–∏–Ω–∞ **–ø—Ä–∏—Å–∫–æ—Ä–∏–ª–∞—Å—è**, –æ—Å–∫—ñ–ª—å–∫–∏ —Ç—Ä—É–±–∞ **–∑–≤—É–∑–∏–ª–∞—Å—è** (–∑–≥—ñ–¥–Ω–æ –∑ —Ä—ñ–≤–Ω. –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω–æ—Å—Ç—ñ).")
    elif v1 > v2:
        st.warning("–†—ñ–¥–∏–Ω–∞ **—Å–ø–æ–≤—ñ–ª—å–Ω–∏–ª–∞—Å—è**, –æ—Å–∫—ñ–ª—å–∫–∏ —Ç—Ä—É–±–∞ **—Ä–æ–∑—à–∏—Ä–∏–ª–∞—Å—è**.")
        
    if P2 < P1:
        st.info("–¢–∏—Å–∫ **–≤–ø–∞–≤**. –¶–µ —Å—Ç–∞–ª–æ—Å—è —Ç–æ–º—É, —â–æ —à–≤–∏–¥–∫—ñ—Å—Ç—å –∑—Ä–æ—Å–ª–∞ (–µ—Ñ–µ–∫—Ç –ë–µ—Ä–Ω—É–ª–ª—ñ) —Ç–∞/–∞–±–æ –≤–∏—Å–æ—Ç–∞ –∑–º–µ–Ω—à–∏–ª–∞—Å—è.")
    elif P2 > P1:
        st.info("–¢–∏—Å–∫ **–∑—Ä—ñ—Å**. –¶–µ —Å—Ç–∞–ª–æ—Å—è —Ç–æ–º—É, —â–æ —à–≤–∏–¥–∫—ñ—Å—Ç—å –≤–ø–∞–ª–∞ —Ç–∞/–∞–±–æ –≤–∏—Å–æ—Ç–∞ –∑–±—ñ–ª—å—à–∏–ª–∞—Å—è.")