import streamlit as st
import numpy as np
import scipy.constants as const

with st.container(border=True):
    st.title("‚öõÔ∏è –ê—Ç–æ–º–Ω—ñ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∏")
    st.write("–†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –∑–∞ —Ñ–æ—Ä–º—É–ª–∞–º–∏ –∑ –≤—Å—Ç—É–ø—É –¥–æ –∫–≤–∞–Ω—Ç–æ–≤–æ—ó –º–µ—Ö–∞–Ω—ñ–∫–∏.")

    # --- –°—Ç–≤–æ—Ä—é—î–º–æ –¥–≤—ñ –≤–∫–ª–∞–¥–∫–∏ ---
    tab1, tab2 = st.tabs(["–§–æ—Ä–º—É–ª–∞ –†—ñ–¥–±–µ—Ä–≥–∞ (–õ.1)", "–•–≤–∏–ª—è –¥–µ –ë—Ä–æ–π–ª—è (–õ.2)"])

    # --- –í–∫–ª–∞–¥–∫–∞ 1: –§–æ—Ä–º—É–ª–∞ –†—ñ–¥–±–µ—Ä–≥–∞ ---
    with tab1:
        st.header("–§–æ—Ä–º—É–ª–∞ –†—ñ–¥–±–µ—Ä–≥–∞ (—Å–µ—Ä—ñ—è –ë–∞–ª—å–º–µ—Ä–∞, etc.)")
        st.write("–†–æ–∑—Ä–∞—Ö–æ–≤—É—î –¥–æ–≤–∂–∏–Ω—É —Ö–≤–∏–ª—ñ —Ñ–æ—Ç–æ–Ω–∞, —â–æ –≤–∏–ø—Ä–æ–º—ñ–Ω—é—î—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥—ñ –µ–ª–µ–∫—Ç—Ä–æ–Ω–∞ –≤ –∞—Ç–æ–º—ñ –≤–æ–¥–Ω—é.")
        
        # --- –ë–õ–û–ö –¢–ï–û–†–Ü–á ---
        with st.expander("üìñ –í—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–µ–æ—Ä—ñ—é —Ç–∞ —Ñ–æ—Ä–º—É–ª–∏", expanded=False):
            st.write("–§–æ—Ä–º—É–ª–∞ –†—ñ–¥–±–µ—Ä–≥–∞ –æ–ø–∏—Å—É—î —Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó –≤–æ–¥–Ω—é:")
            st.latex(r"\frac{1}{\lambda} = R \left( \frac{1}{n_f^2} - \frac{1}{n_i^2} \right)")
            st.markdown("""
            * $R$ ‚Äî —Å—Ç–∞–ª–∞ –†—ñ–¥–±–µ—Ä–≥–∞ ($1.097 \times 10^7$ –º‚Åª¬π)
            * $n_i$ ‚Äî –ø–æ—á–∞—Ç–∫–æ–≤–∏–π (–≤–∏—â–∏–π) –µ–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å
            * $n_f$ ‚Äî –∫—ñ–Ω—Ü–µ–≤–∏–π (–Ω–∏–∂—á–∏–π) –µ–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å
            * **–°–µ—Ä—ñ—è –õ–∞–π–º–∞–Ω–∞:** $n_f = 1$ (–£–§)
            * **–°–µ—Ä—ñ—è –ë–∞–ª—å–º–µ—Ä–∞:** $n_f = 2$ (–í–∏–¥–∏–º–∏–π)
            * **–°–µ—Ä—ñ—è –ü–∞—à–µ–Ω–∞:** $n_f = 3$ (–Ü–ß)
            """)

        col1, col2 = st.columns(2)
        n_i = col1.number_input("–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å (n_i)", min_value=2, value=3, step=1, 
                                help="–í–∏—â–∏–π –µ–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å", key="ryd_ni") # <-- –î–æ–¥–∞–Ω–æ key
        n_f = col2.number_input("–ö—ñ–Ω—Ü–µ–≤–∏–π —Ä—ñ–≤–µ–Ω—å (n_f)", min_value=1, value=2, step=1,
                                help="–ù–∏–∂—á–∏–π –µ–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å", key="ryd_nf") # <-- –î–æ–¥–∞–Ω–æ key

        if n_i <= n_f:
            st.error("–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å (n_i) –º–∞—î –±—É—Ç–∏ –±—ñ–ª—å—à–∏–º –∑–∞ –∫—ñ–Ω—Ü–µ–≤–∏–π (n_f) –¥–ª—è –≤–∏–ø—Ä–æ–º—ñ–Ω—é–≤–∞–Ω–Ω—è.")
        else:
            R = const.Rydberg
            inv_lambda = R * (1/n_f**2 - 1/n_i**2)
            lambda_meters = 1 / inv_lambda
            lambda_nm = lambda_meters * 1e9 # –ü–µ—Ä–µ–≤–æ–¥–∏–º–æ –≤ –Ω–∞–Ω–æ–º–µ—Ç—Ä–∏
            
            st.metric("–î–æ–≤–∂–∏–Ω–∞ —Ö–≤–∏–ª—ñ (Œª)", f"{lambda_nm:.2f} –Ω–º")
            
            if lambda_nm >= 380 and lambda_nm <= 750:
                st.success("–¶—è —Ö–≤–∏–ª—è –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —É –≤–∏–¥–∏–º–æ–º—É –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ!")
            else:
                st.info("–¶—è —Ö–≤–∏–ª—è –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –ø–æ–∑–∞ –≤–∏–¥–∏–º–∏–º –¥—ñ–∞–ø–∞–∑–æ–Ω–æ–º (–£–§ –∞–±–æ –Ü–ß).")

    # --- –í–∫–ª–∞–¥–∫–∞ 2: –•–≤–∏–ª—è –¥–µ –ë—Ä–æ–π–ª—è ---
    with tab2:
        st.header("–î–æ–≤–∂–∏–Ω–∞ —Ö–≤–∏–ª—ñ –¥–µ –ë—Ä–æ–π–ª—è")
        st.write("–†–æ–∑—Ä–∞—Ö–æ–≤—É—î –¥–æ–≤–∂–∏–Ω—É —Ö–≤–∏–ª—ñ, –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω—É –∑ —á–∞—Å—Ç–∏–Ω–∫–æ—é, —â–æ —Ä—É—Ö–∞—î—Ç—å—Å—è.")

        # --- –ë–õ–û–ö –¢–ï–û–†–Ü–á ---
        with st.expander("üìñ –í—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–µ–æ—Ä—ñ—é —Ç–∞ —Ñ–æ—Ä–º—É–ª–∏", expanded=False):
            st.write("–õ—É—ó –¥–µ –ë—Ä–æ–π–ª—å –ø—Ä–∏–ø—É—Å—Ç–∏–≤, —â–æ –≤—Å—ñ —á–∞—Å—Ç–∏–Ω–∫–∏ –º–∞—Ç–µ—Ä—ñ—ó –º–∞—é—Ç—å —Ö–≤–∏–ª—å–æ–≤—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ. –î–æ–≤–∂–∏–Ω–∞ —Ö–≤–∏–ª—ñ —á–∞—Å—Ç–∏–Ω–∫–∏ –ø–æ–≤'—è–∑–∞–Ω–∞ –∑ —ó—ó —ñ–º–ø—É–ª—å—Å–æ–º:")
            st.latex(r"\lambda = \frac{h}{p} = \frac{h}{m \cdot v}")
            st.markdown("""
            * $\lambda$ ‚Äî –¥–æ–≤–∂–∏–Ω–∞ —Ö–≤–∏–ª—ñ –¥–µ –ë—Ä–æ–π–ª—è
            * $h$ ‚Äî —Å—Ç–∞–ª–∞ –ü–ª–∞–Ω–∫–∞
            * $p$ ‚Äî —ñ–º–ø—É–ª—å—Å —á–∞—Å—Ç–∏–Ω–∫–∏
            * $m$ ‚Äî –º–∞—Å–∞, $v$ ‚Äî —à–≤–∏–¥–∫—ñ—Å—Ç—å
            """)

        st.subheader("–û–±–µ—Ä—ñ—Ç—å —á–∞—Å—Ç–∏–Ω–∫—É")
        particle = st.selectbox("–¢–∏–ø —á–∞—Å—Ç–∏–Ω–∫–∏", 
                                ("–ï–ª–µ–∫—Ç—Ä–æ–Ω", "–ü—Ä–æ—Ç–æ–Ω", "–ù–µ–π—Ç—Ä–æ–Ω", "–Ü–Ω—à–∞ (–≤–≤–µ—Å—Ç–∏ –º–∞—Å—É)"),
                                key="debr_particle") # <-- –î–æ–¥–∞–Ω–æ key
        
        m = const.electron_mass # Default
        if particle == "–ï–ª–µ–∫—Ç—Ä–æ–Ω":
            m = const.electron_mass
        elif particle == "–ü—Ä–æ—Ç–æ–Ω":
            m = const.proton_mass
        elif particle == "–ù–µ–π—Ç—Ä–æ–Ω":
            m = const.neutron_mass
        else:
            m = st.number_input("–ú–∞—Å–∞ —á–∞—Å—Ç–∏–Ω–∫–∏ (m), –∫–≥", min_value=1e-31, value=1.0, format="%e", key="debr_mass") # <-- –î–æ–¥–∞–Ω–æ key
        
        st.write(f"–ú–∞—Å–∞ (m) = {m:.2e} –∫–≥")
        
        v = st.number_input("–®–≤–∏–¥–∫—ñ—Å—Ç—å —á–∞—Å—Ç–∏–Ω–∫–∏ (v), –º/—Å", min_value=0.01, value=1e6, key="debr_v") # <-- –î–æ–¥–∞–Ω–æ key
        
        h = const.h
        p = m * v
        lambda_de_broglie = h / p
        lambda_pm = lambda_de_broglie * 1e12 # –ü–µ—Ä–µ–≤–æ–¥–∏–º–æ –≤ –ø—ñ–∫–æ–º–µ—Ç—Ä–∏
        
        st.metric("–Ü–º–ø—É–ª—å—Å (p)", f"{p:.3e} –∫–≥¬∑–º/—Å")
        st.metric("–î–æ–≤–∂–∏–Ω–∞ —Ö–≤–∏–ª—ñ –¥–µ –ë—Ä–æ–π–ª—è (Œª)", f"{lambda_pm:.3f} –ø–º (–ø—ñ–∫–æ–º–µ—Ç—Ä—ñ–≤)")